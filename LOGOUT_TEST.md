# 退出登录功能测试

## 🧪 测试步骤

### 1. **登录状态检查**
- 确保用户已登录
- 检查 `localStorage` 中是否有 `quest_user_session`
- 检查页面是否显示用户信息

### 2. **点击退出登录按钮**
- 在 My Space 页面点击右上角的退出登录按钮
- 在首页点击退出登录按钮

### 3. **验证退出结果**
- 检查控制台日志：应该看到 "🚪 用户点击登出..." 和 "✅ 登出成功"
- 检查 `localStorage` 是否被清空
- 检查页面是否跳转到登录页面或首页

## 🔍 预期行为

### **成功退出时：**
1. 立即清除本地状态
2. 跳转到登录页面（My Space）或首页（首页）
3. 不再显示用户信息
4. 需要重新登录才能访问受保护的功能

### **清除的数据：**
- `quest_user_session` - 用户会话
- `authToken` - 旧版token存储
- `quest_user_profile` - 用户资料
- `quest_user_insights` - 用户insights
- API token - 通过 `api.setAuthToken(null)` 清除

## 🐛 常见问题

### **问题1：退出后仍然显示用户信息**
- 检查 `auth.clearSession()` 是否被正确调用
- 检查 `updateUIForLoginStatus(false)` 是否被调用

### **问题2：页面没有跳转**
- 检查 `window.location.href` 设置是否正确
- 检查是否有其他JavaScript错误阻止跳转

### **问题3：localStorage没有被清空**
- 检查 `localStorage.removeItem()` 调用是否正确
- 检查浏览器开发者工具中的Application标签

## 📝 测试用例

### **用例1：正常退出**
1. 用户登录
2. 点击退出登录
3. 验证状态清除
4. 验证页面跳转

### **用例2：异常情况退出**
1. 用户登录
2. 模拟网络错误
3. 点击退出登录
4. 验证即使出错也能清除状态

### **用例3：多页面退出**
1. 在My Space页面退出
2. 在首页退出
3. 验证两个页面的退出逻辑一致

## 🔧 调试信息

### **控制台日志**
```
🚪 用户点击登出...
🗑️ 开始清理用户会话...
✅ 会话已完全清除
✅ 登出成功
```

### **localStorage状态**
- 退出前：包含用户会话数据
- 退出后：完全清空

### **页面跳转**
- My Space → `/pages/login.html`
- 首页 → `/`
