<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™»å½•é—®é¢˜è¯Šæ–­ - Quest</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        button { padding: 10px 20px; margin: 5px; }
        .result { background: #f5f5f5; padding: 10px; margin: 10px 0; white-space: pre-wrap; }
        .step { margin: 10px 0; padding: 10px; background: #e8f4fd; border-left: 4px solid #2196F3; }
    </style>
</head>
<body>
    <h1>ğŸ” ç™»å½•é—®é¢˜è¯Šæ–­ - API æ ¼å¼ä¿®å¤ç‰ˆ</h1>
    
    <div class="test">
        <h3>1. ç›´æ¥æµ‹è¯• API ç«¯ç‚¹ï¼ˆåŸå§‹æ ¼å¼ï¼‰</h3>
        <button onclick="testDirectApi()">ç›´æ¥è°ƒç”¨ç™»å½• API</button>
        <div id="directApiResult" class="result"></div>
    </div>
    
    <div class="test">
        <h3>2. æµ‹è¯• API æ ¼å¼è½¬æ¢</h3>
        <button onclick="testApiFormat()">æµ‹è¯• API æ ¼å¼è½¬æ¢</button>
        <div id="apiFormatResult" class="result"></div>
    </div>
    
    <div class="test">
        <h3>3. æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹</h3>
        <button onclick="testAuthLogin()">æµ‹è¯• auth.login()</button>
        <div id="authLoginResult" class="result"></div>
    </div>
    
    <div class="test">
        <h3>4. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—</h3>
        <p>è¯·æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·çš„æ§åˆ¶å°ï¼ŒæŸ¥çœ‹è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯</p>
        <div class="step">
            <strong>è°ƒè¯•æ­¥éª¤ï¼š</strong><br>
            1. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·<br>
            2. åˆ‡æ¢åˆ° Console æ ‡ç­¾<br>
            3. è¿è¡Œä¸Šé¢çš„æµ‹è¯•<br>
            4. æŸ¥çœ‹è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
        </div>
    </div>

    <script type="module">
        import { auth } from '/js/auth.js';
        import { api } from '/js/api.js';
        
        window.testDirectApi = async function() {
            const result = document.getElementById('directApiResult');
            result.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                const url = 'https://quest-api-edz1.onrender.com/api/v1/auth/login';
                console.log('ğŸ” ç›´æ¥æµ‹è¯• API:', url);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'test@example.com',
                        password: 'testpass123'
                    })
                });
                
                console.log('ğŸ“¡ å“åº”çŠ¶æ€:', response.status);
                console.log('ğŸ“¡ å“åº”å¤´:', Object.fromEntries(response.headers.entries()));
                
                const data = await response.text();
                console.log('ğŸ“¡ å“åº”æ•°æ®:', data);
                
                result.innerHTML = `
âœ… ç›´æ¥ API è°ƒç”¨æˆåŠŸ!
çŠ¶æ€: ${response.status} ${response.statusText}
æ•°æ®: ${data}
                `;
            } catch (error) {
                console.error('âŒ ç›´æ¥ API è°ƒç”¨å¤±è´¥:', error);
                result.innerHTML = `
âŒ ç›´æ¥ API è°ƒç”¨å¤±è´¥!
é”™è¯¯: ${error.message}
ç±»å‹: ${error.name}
                `;
            }
        };
        
        window.testApiFormat = async function() {
            const result = document.getElementById('apiFormatResult');
            result.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                console.log('ğŸ” æµ‹è¯• API æ ¼å¼è½¬æ¢...');
                
                // æ¨¡æ‹Ÿåç«¯è¿”å›çš„æ ¼å¼
                const mockBackendResponse = {
                    success: true,
                    data: {
                        access_token: "mock_token_123",
                        user_id: "user_456"
                    }
                };
                
                console.log('ğŸ“¡ æ¨¡æ‹Ÿåç«¯å“åº”:', mockBackendResponse);
                
                // æµ‹è¯•è½¬æ¢é€»è¾‘
                if (mockBackendResponse && mockBackendResponse.success && mockBackendResponse.data) {
                    const converted = {
                        user: {
                            id: mockBackendResponse.data.user_id,
                            email: 'test@example.com'
                        },
                        token: mockBackendResponse.data.access_token
                    };
                    
                    console.log('âœ… è½¬æ¢åçš„æ ¼å¼:', converted);
                    
                    result.innerHTML = `
âœ… API æ ¼å¼è½¬æ¢æµ‹è¯•æˆåŠŸ!
åŸå§‹æ ¼å¼: ${JSON.stringify(mockBackendResponse, null, 2)}
è½¬æ¢å: ${JSON.stringify(converted, null, 2)}
                    `;
                } else {
                    throw new Error('æ¨¡æ‹Ÿå“åº”æ ¼å¼ä¸æ­£ç¡®');
                }
            } catch (error) {
                console.error('âŒ API æ ¼å¼è½¬æ¢æµ‹è¯•å¤±è´¥:', error);
                result.innerHTML = `
âŒ API æ ¼å¼è½¬æ¢æµ‹è¯•å¤±è´¥!
é”™è¯¯: ${error.message}
                `;
            }
        };
        
        window.testAuthLogin = async function() {
            const result = document.getElementById('authLoginResult');
            result.textContent = 'æµ‹è¯•ä¸­...';
            
            try {
                console.log('ğŸ” å¼€å§‹æµ‹è¯•å®Œæ•´ç™»å½•æµç¨‹...');
                const loginResult = await auth.login('test@example.com', 'testpass123');
                console.log('ğŸ“¡ auth.login() ç»“æœ:', loginResult);
                
                if (loginResult && loginResult.success) {
                    result.innerHTML = `
âœ… å®Œæ•´ç™»å½•æµç¨‹æˆåŠŸ!
ç»“æœ: ${JSON.stringify(loginResult, null, 2)}
ç”¨æˆ·è®¤è¯çŠ¶æ€: ${auth.checkAuth()}
å½“å‰ç”¨æˆ·: ${JSON.stringify(auth.getCurrentUser(), null, 2)}
                    `;
                } else {
                    result.innerHTML = `
âŒ å®Œæ•´ç™»å½•æµç¨‹å¤±è´¥!
ç»“æœ: ${JSON.stringify(loginResult, null, 2)}
                    `;
                }
            } catch (error) {
                console.error('âŒ å®Œæ•´ç™»å½•æµç¨‹å¼‚å¸¸:', error);
                result.innerHTML = `
ğŸš¨ å®Œæ•´ç™»å½•æµç¨‹æŠ›å‡ºå¼‚å¸¸!
é”™è¯¯: ${error.message}
ç±»å‹: ${error.name}
å †æ ˆ: ${error.stack}
                `;
            }
        };
    </script>
</body>
</html>
